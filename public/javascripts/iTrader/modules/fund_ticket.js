define(function(require,exports,module){function a(){$(document).on("ticket-added",function(a,b){if(b&&10==b[tags.productType]){$("#ticket-side").val(g);var d=c(b,{side:g});$("#ticket-fund-nav").text(d.nav.value),0==g?(h.text(d.minAmt.value),h.parent().removeClass("hidden")):h.parent().addClass("hidden");var f=$("#ticket-fund-transaction-fee"),i=$("#ticket-fund-min-transaction-fee-amount");d.txn?(f.text(d.txn.value),f.parent("div").removeClass("hidden")):f.parent("div").addClass("hidden"),d.minTxnAmt?(i.text(d.minTxnAmt.value),i.parent("div").removeClass("hidden")):i.parent("div").addClass("hidden"),e.focus(),e.InputFormat()}}),$("[name=ticket-fund-radio-side]").change(function(){g=$(this).val(),$("#ticket-side").val(g);var a=$("#ticket-btn-fund-side");a.val(g),0==g?(a.text(messages.ticket_subscribe.text),a.removeClass("btn-danger").addClass("btn-success"),e.attr("placeHolder",messages.fund_subscription_amount.placeHolder)):(a.text(messages.ticket_redeem.text),a.addClass("btn-danger").removeClass("btn-success"),e.attr("placeHolder",messages.ticket_fund_unit.placeHolder)),$("#ticket-input-symbol-code").trigger("blur")})}function b(){$(".fund-info").text(""),e.val("")}function c(a,b){if(a){b=b||{};var c={},d=b.side||0,e=a[tags.currency],g=f.base_currency,h=a[23]||"",j=a[3605],k=a[3407]||"",l=a[3408]||"";1==d&&(a[3606]&&(k=a[3606]),a[3607]&&(l=a[3607]));var m="";if(a[31]&&(m=a[31],a[3608]&&(m+=" ({0})".format(moment(a[3608],"YYYYMMDD").format("YYYY/MM/DD")))),c.currency={name:messages.column_currency.text+": ",value:h},c.nav={name:messages.ticket_fund_nav.text,value:m},c.txn={name:messages.ticket_fund_transaction_fee.text,value:$._format.percentage(k,2)},c.minAmt={name:messages.ticket_fund_min_subscription_amount.text,value:$._format.amount(a[3401]||"")+"({0})".format(e)},c.minTxnAmt={name:messages.ticket_fund_min_transaction_fee_amount.text,value:$._format.amount(l)+"({0})".format(g)},16&j?(c.txn.value=messages.FreeTransactionFee.text,c.minTxnAmt.value=messages.FreeTransactionFee.text):32&j&&(0!=d||2&j?1!=d||4&j||(delete c.txn,delete c.minTxnAmt):(delete c.txn,delete c.minTxnAmt)),1==d){delete c.minAmt,c.availableQuantity={name:messages.ticket_fund_available_unit.text,value:$._format.pattern(GetMaxSellSync(a[0]),initial_data.format.fund_unit)+"({0})".format(e)};var n;a[3611]&&a[3611]>0&&a[31]&&a[31]>0&&(n=Math.ceil(a[3611]/(.95*a[31]))),c.minHoldingUnit={name:messages.ticket_fund_min_holding_unit.text,value:"undefined"==typeof n?messages.NotApplicableValue.text:$._format.pattern(n,i)}}return c}}function d(a){$.get("/iTrader/fund/disclaimer?type=disclosure",function(b){b&&b.url?showMessage({title:messages.dialog_disclosure_title.text,buttonNameList:["agree","reject"],load:{url:getMultiLanguageURL(b)},callback:function(b,c){var d=b.attr("id");"btn-reject"===d?(a(!1),a=null):"btn-agree"===d&&(a(!0),a=null),c.close()},onshow:function(a){a.getModalBody().css("max-height","450px")},onhide:function(){a&&a(!1)}}):a(!0)})}var e=$("#ticket-fund-amount-unit"),f=($("#ticket-btn-fund-side"),AccountMgr,CurrencyMgr),g="0",h=$("#ticket-fund-min-subscription-amount"),i=initial_data.format.fund_unit;exports.init=a,exports.clear=b,exports.getFundInfo=c,exports.popupFundDisclaimer=d});