define(function(require,exports,module){function a(a){if(a&&(h=a,j=a.find("table"),!(j.length<=0))){i=j.CreateDatatable({columnSchema:initial_data.views.trade.price_quote_book.schema,columnHeaderPrefix:"orderbook_header_",order:[3,"desc"],aoColumnDefs:[{bSortable:!1,aTargets:[0,1]},{className:"prevent-popup-detail",targets:[0,1]}],buttons:[{extend:"print",exportOptions:{columns:function(a,b,c){return a>1}},className:"btn-print"}]});var e=$(i.table().container()),f=i.buttons().container();f.addClass("pull-right"),f.find("a span").remove(),f.find("a").append($("<i class='fa fa-lg fa-print text-muted'></i>")),f.appendTo(e.find(".dataTables_filter label")),$("#pricequote-filter").appendTo($(".col-sm-6:eq(0)",e)),OrderMgr.on(function(a){if(a&&!(a.length<=0)){for(var b=0;b<a.length;b++){var c=a[b];k.IsPriceQuoteOrder(c)&&d(c)}i.draw(!1)}});var g={name:{i18n:"pricequote_status"},data:[{key:"ALL",value:messages.ALL.text},{key:"quote_1",value:messages.oms.status_quote_1},{key:"quote_2",value:messages.oms.status_quote_2},{key:"quote_3",value:messages.oms.status_quote_3}]},l=(initial_data.views.trade.order_book.filter.status,$("#pricequote-status-dropdown-group"));l.CreateDrowdownGroup(g);var m=i.columns().dataSrc();if(m.length>0){var n=m.indexOf("5");n>=0&&l.on("change",function(a,b){b="ALL"===b?"":$._map.status(b),i.column(n).search(b).draw()})}j.on("click",function(a){var d=$(a.target),e=d.attr("action"),f=d.parents("tr"),g=i.row(f),h=g.data();"agree"===e?b(h):"cancel"===e&&c(h)}),h.translate()}}function b(a){if(a){var b=a[6],c=OrderMgr.get(b);c&&showMessage({title:messages.price_quote_agree_confirmation_title.text+AccountMgr.current_account,type:BootstrapDialog.TYPE_SUCCESS,load:{url:"/iTrader/order/pricequote/comfirm?orderNo="+b,callback:function(a){current.symbol=$("#cancel-confirmation-symbol").text(),a.$modal.format(),a.$modal.translate(),a.$modal.find("[data-format=price]").each(function(){$(this).text(getDisplayPrice($(this).text(),"order",c))})}},buttonNameList:["submit","close"],callback:function(a,c){if("close"===a.name)c.close();else if("submit"===a.name){var d=$("input[name=_csrf]").val(),e="_csrf="+d+"&orderNo="+b+"&cmd=change";$.ajax({type:"post",url:"/iTrader/order/submit",data:e,success:function(a){a?alertMessage({title:messages.dialog_information_title.text,message:messages.order_confirmation_order_submitted_message.text}):handleError(a)},error:handleError}),c.close()}}})}}function c(a){if(a){var b=a[6],c=OrderMgr.get(b);c&&showMessage({title:messages.price_quote_cancel_confirmation_title.text+c[tags.account],type:BootstrapDialog.TYPE_DANGER,load:{url:"/iTrader/order/cancel?orderNo="+b+"&tempNo="+(new Date).getTime(),callback:function(a){current.symbol=$("#cancel-confirmation-symbol").text(),a.$modal.format(),a.$modal.translate(),a.$modal.find("[data-format=price]").each(function(){$(this).text(getDisplayPrice($(this).text(),"order",c))})}},buttonNameList:["submit","close"],callback:function(a,c){if("close"===a.name)c.close();else if("submit"===a.name){var d=$("input[name=_csrf]").val(),e="_csrf="+d+"&orderNo="+b+"&cmd=cancel";$.ajax({type:"post",url:"/iTrader/order/submit",data:e,success:function(a){a?alertMessage({title:messages.dialog_information_title.text,message:messages.order_confirmation_order_cancel_submitted_message.text}):handleError(a)},error:handleError}),c.close()}}})}}function d(a){if(j&&!(j.length<=0)){var b=i.row();if("object"==typeof a&&a[tags.orderNo]){a.DT_RowId="price-quote-order-"+a._id,g(a);var c=a._raw[5],d=a._raw[487].QState,h=(32&a._raw[40])>0;d&&h&&1==c&&(a[5]=$._map.status("quote_"+d));var l=f(a),m=e(a);l?a.agree="<a href='javascript:void(0);'><i class='fa fa-check fa-lg text-success' title='{0}' action='agree'></i></a>".format(messages.price_quote_agree.text):a.agree="<i class='fa fa-check fa-lg text-muted' title='{0}'></i>".format(messages.price_quote_agree.text),m?a.cancel="<a href='javascript:void(0);'><i class='fa fa-remove fa-lg text-danger' title='{0}' action='cancel'></i></a>".format(messages.price_quote_cancel.text):a.cancel="<i class='fa fa-remove fa-lg text-muted' title='{0}'></i>".format(messages.price_quote_cancel.text);var b=i.UpdateRowData(a,{IsRemove:function(a){return!k.IsOrderInPriceQuoteStage(a)}});k.ApplyColor(b);for(var n=i.rows(),o=0,p=0;p<n[0].length;p++){var q=i.row(p).data();f(q)&&o++}o?($("#tab-price_quote_book").addClass("tab-message-notice"),$("#tab-price_quote_book").text(o)):($("#tab-price_quote_book").removeClass("tab-message-notice"),$("#tab-price_quote_book").text(""))}}}function e(a){if(a&&a._raw)return!!IsOutstandingStatus(a._raw[5])}function f(a){if(a&&a._raw)return 1==a._raw[5]&&3==a._raw[487].QState&&0!=(32&a._raw[40])}function g(a){if(a&&a[489]&&32768&a[489]){a.isBulkChildOrder=!0;var b=a[25]||"";b.indexOf(messages.remark_bulk_order.text)<0&&(b=messages.remark_bulk_order.text+b),a[25]=b}}require("datatables");var h,i,j,k=require("util");exports.init=a});