var g_socket;define(function(require,exports,module){function a(){var a=window.location.protocol+"//"+window.location.host;g_socket=io.connect(a,{secure:!!_.startsWith(a,"https")}),g_socket.on("auth",function(a){a&&g_socket.emit("data",["order","position","account","currency","spread"])}),g_socket.on("data",function(a){a&&a.name&&a.data&&b(a)}),g_socket.on("message",function(a){a&&("logout"===a.action?$(".index-row").remove():"announce"===a.action&&e.push(a.announcement),a.errorCode&&(a.errorCode&&messages.error["SSMITSERR_"+a.errorCode]&&(a.errorCode="SSMITSERR_"+a.errorCode),handleError(a,function(){"logout"===a.action&&Logout()})))}),g_socket.emit("auth");var f=setInterval(function(){c=c||(new Date).getTime(),!d&&(new Date).getTime()-c>1e3&&($(document).trigger("page","show"),d=!0,clearInterval(f))},500)}function b(a){if(c=(new Date).getTime(),a&&a.name&&a.data){for(var b=0;b<a.data.length;b++){var d=a.data[b];d&&(d._raw=$.extend(!0,{},d))}"order"===a.name?OrderMgr.set(a.data):"position"===a.name?PositionMgr.set(a.data):"account"===a.name?AccountMgr.set(a.data):"currency"===a.name?CurrencyMgr.set(a.data):"spread"===a.name?SpreadMgr.set(a.data):"errororder"===a.name&&ErrorOrderMgr.set(a.data)}}var c,d=!1,e=[];$("[data-update]").click(function(){var a=$(this).attr("data-update");a&&g_socket.emit("update",a)}),$(document).on("page",function(a,b){if("shown"===b){if(e&&e.length>0)for(var c=0;c<e.length;c++)PopupAnnouncement(e[c]);e=[]}}),exports.init=a});