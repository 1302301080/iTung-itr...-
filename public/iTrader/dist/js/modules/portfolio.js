define(function(require,exports,module){function a(a,e){if(f=a,k=e||{defaultMarket:"ALL"},"undefined"==typeof k.disableTooltip&&(k.disableTooltip=!1),j="ALL"===k.defaultMarket?"":k.defaultMarket,f&&!(f.length<=0)&&!(f.find("table").length<=0)){g=$(f.find("table")[0]),i=$("#portfolio-dropdown-group");for(var l=k.schema||initial_data.views.trade.portfolio.schema,m=[],n=0;n<l.length;n++)m.push(l[n]);m.push({key:"hide_exchange"}),m.push({key:"hide_account"}),h=g.CreateDatatable({columnSchema:m,columnHeaderPrefix:"portfolio_header_",pageLength:7,columnDefs:[{className:"copyprice"+(k.disableTooltip?"":" portfolio-extra"),targets:[0]}]});var o=h.columns()[0].length;h.column(o-1).visible(!1),h.column(o-2).visible(!1);var p=$(h.table().container()),q=h.buttons().container();p.find(".dataTables_filter label").addClass("search-box").appendTo($("#portfolio-search")),q.addClass("pull-right"),q.find("a span").remove(),q.find("a").append($("<i class='fa fa-lg fa-print text-muted'></i>")),q.appendTo(p.find(".dataTables_filter label")),$("#nav_account").on("change",function(){d()}),i.on("change",function(a,b){j="ALL"===b?"":b,d()}),PositionMgr.on(function(a){if(a&&!(a.length<=0)){for(var c=0;c<a.length;c++)b(a[c]);h.draw(!1)}}),ExchangeMgr.on(function(){c(k)}),g.on("click",function(a){if($(a.target).hasClass("copyprice")){var b="#"+$(a.target).parent("tr").attr("id"),c=h.row(b);if(c&&"function"==typeof c.data){var d=h.row(b).data();if(!d||!d._raw)return;window.postMessage({name:"copy-symbol",exchange:d._raw[20],symbol:d._raw[0],type:"sell",quantity:GetMaxSellSync(d._raw[0])},"/")}}}),f.translate()}}function b(a){if(a&&a._raw){var b=a._raw;if(!(AccountMgr.current_account&&b[10]!==AccountMgr.current_account||j&&b[20]!==j)){var c=b[0],d=b[10],f=b[20];a.DT_RowId="position-"+d+"-"+c,f&&ExchangeMgr.exchange_flag[f]&&(a[0]="<i class='flag-icon {0}' style='margin-right:5px;'></i>{1}".format(ExchangeMgr.exchange_flag[f],c)),l.HandleZeroShowNA(a);var g=h.UpdateRowData(a,{IsRemove:function(a){return 0==a[tags.quantity]||"cash"===a.voucherType}});g&&g.isNewRow&&$(g.node()).find(".portfolio-extra").each(function(){if("tooltip"!==$(this).attr("data-toggle")){$(this).attr("data-toggle","tooltip").attr("data-placement","right");var a=this;$(this).tooltip({html:!0,container:"body",trigger:"hover",title:function(){var b=h.row("#"+$(a).parent("tr").attr("id"));if(b&&b.data())return e(b.data())}})}})}}}function c(a){var b={name:{i18n:"portfolio_market"},data:[{key:a.defaultMarket,value:"ALL"==a.defaultMarket?messages.ALL.text:$._map.exchange(a.defaultMarket)}]};"ALL"!=b.data[0].key&&b.data.push({key:"ALL",value:messages.ALL.text});for(var c=0;c<ExchangeMgr.exchanges.length;c++){var d=ExchangeMgr.exchanges[c];d!=a.defaultMarket&&b.data.push({key:d,value:$._map.exchange(d)})}i.CreateDrowdownGroup(b)}function d(){h.clear();for(var a=PositionMgr.get({account:AccountMgr.current_account,exchange:j}),c=0;c<a.length;c++)b(a[c]);h.draw()}function e(a){if(a){var b=$("<table class='portfolio-hint'></table>");if(initial_data.views.trade.portfolio.tooltip)for(var c=0;c<initial_data.views.trade.portfolio.tooltip.length;c++){var d=initial_data.views.trade.portfolio.tooltip[c];if(d&&d.key){var e=$("<tr></tr>"),f=d.i18n||"portfolio_hint_"+d.key,g=messages[f]?messages[f].text:0,h=a[d.key];"undefined"!=typeof h&&null!=h||(h=""),e.append("<td style='text-align:left; padding-right:20px; word-break: keep-all;white-space:nowrap;'>{0}</td>".format(g)),e.append("<td style='text-align:left; word-break: keep-all;white-space:nowrap;' data-format='{0}'>{1}</td>".format(d.format,h)),b.append(e)}}return b.format(),b.html()}}var f,g,h,i,j,k={},l=require("util");exports.init=a});