define(function(require,exports,module){function a(){var a=j.find("span[data-key]").attr("data-key");$.ajax({url:"/iTrader/message/settlemetTable",method:"GET",data:{account:AccountMgr.current_account,period:a},success:function(a){a&&d(a),i.find("li[style='display: none;'] a").trigger("click"),k.find("li[style='display: none;'] a").trigger("click"),b()},error:function(){b()}})}function b(){l.find(".btn-icon-spinner").addClass("hidden"),l.find(".btn-icon-search").removeClass("hidden"),l.removeAttr("disabled")}function c(a){if(a){var b=$(a.table().container()),c=a.buttons().container();b.find(".dataTables_filter label input").attr("placeHolder",messages.datatables.sSearchPlaceHolder),c.addClass("pull-right"),c.find("a span, a i").remove(),c.find("a").append($("<i class='fa fa-lg fa-print text-muted'></i>")),c.appendTo(b.find(".dataTables_filter label")),$("#settlement-instruction-form").appendTo($(".col-sm-6:eq(0)",a.table().container()))}}function d(a){if(a&&(f.clear(),a)){for(var b=0;b<a.length;b++){(a[b].status||0===a[b].status)&&(a[b].status=$._map.status("settlement_instruction_"+a[b].status)),a[b][158]&&(a[b][158]=messages["settlement_instruction_"+a[b][158]].text),a[b][163]="<span class='text-muted pointer settlement-subject' msgID={0}>{1}</span>".format(a[b][160],a[b][163]);var c=f.UpdateRowData(a[b]);1==a[b].detail.BankSlip&&$(c.node()).find(".settlement-subject").parent().append($("<a>",{href:"/iTrader/message/settlement/image?name={0}_BankSlip_{1}".format(a[b][161],a[b][160]),target:"_blank"}).append($("<i>",{"class":"fa fa-file-image-o icon-left-margin pointer",title:messages.settlement_CD_bankSlip.text}))),1==a[b].detail.Cheque&&$(c.node()).find(".settlement-subject").parent().append($("<a>",{href:"/iTrader/message/settlement/image?name={0}_Cheque_{1}".format(a[b][161],a[b][160]),target:"_blank"}).append($("<i>",{"class":"fa fa-picture-o  icon-left-margin pointer",title:messages.settlement_CD_cheque.text}))),$(c.node()).find(".settlement-subject").click(function(){var a=$(this).attr("msgID");g.showMessage({title:messages.dialog_detail_title.text,load:{url:"/iTrader/message/settlement/detail?account="+AccountMgr.current_account+"&msgID="+a,callback:function(){}},buttonNameList:["close"],callback:function(a,b){"close"===a.name&&b.close()}})})}f.draw()}}function e(){f=h.CreateDatatable({searching:!0,columnSchema:initial_data.views.settlement.schema,order:[0,"desc"],buttons:[{extend:"print",className:"btn-print"}]});var a={name:{i18n:"settlement_message_type"},data:[{key:"ALL",value:messages.settlement_instruction_all_type.text},{key:"CD",value:messages.settlement_instruction_CD.text},{key:"CW",value:messages.settlement_instruction_CW.text},{key:"SD",value:messages.settlement_instruction_SD.text},{key:"SW",value:messages.settlement_instruction_SW.text}]},b={name:{i18n:"settlement_arrival_date"},data:[]};if(initial_data.views.settlement.periods)for(var c=0;c<initial_data.views.settlement.periods.length;c++){var d=initial_data.views.settlement.periods[c];b.data.push({key:d,value:messages["settlement_period_"+d].text})}var e={name:{i18n:"settlement_status"},data:[{key:"ALL",value:messages.ALL.text},{key:"0",value:messages.oms.status_settlement_instruction_0},{key:"1",value:messages.oms.status_settlement_instruction_1},{key:"2",value:messages.oms.status_settlement_instruction_2},{key:"-1",value:messages.oms["status_settlement_instruction_-1"]}]};i.CreateDrowdownGroup(a),j.CreateDrowdownGroup(b),k.CreateDrowdownGroup(e)}require("datatables");var f,g=require("dialog"),h=$("#settlement_table"),i=$("#settlement_type"),j=$("#settlement_period"),k=$("#settlement_status"),l=$("#settlement_btn");e(),l.click(function(){l.find(".btn-icon-spinner").removeClass("hidden"),l.find(".btn-icon-search").addClass("hidden"),l.attr("disabled","disabled"),a()}),c(f),$(document).translate(),k.on("change",function(a,b){var c=f.columns().dataSrc();if(c.length>0){var d=c.indexOf("status");if(d<=0)return;b="ALL"===b?"":$._map.status("settlement_instruction_"+b),f.column(d).search(b).draw()}}),i.on("change",function(a,b){var c=f.columns().dataSrc();if(c.length>0){var d=c.indexOf("158");if(d<=0)return;b="ALL"===b?"":messages["settlement_instruction_"+b].text,f.column(d).search(b).draw()}})});