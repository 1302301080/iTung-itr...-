define(function(require,exports,module){function a(a){a=a||{};var c={};c.sessionID=a.sessionID,c.cmd=a.cmd,g.showMessage({title:messages.login_2FA_registration_title.text,closeByBackdrop:!1,closeByKeyboard:!1,load:{url:"/iTrader/security/2FARegistration?sessionID="+(c.sessionID||""),callback:function(){$(".token-list input:radio").click(function(){var a=$(this).val();if("ebrokerkey"==a){$(".delivery-method").removeClass("hidden");var b=$(".delivery-list input[name='delivery']:checked").val();c.tokenType=5,c.deliveryMethod=b,$(".delivery-list input:radio").click(function(){c.deliveryMethod=$(".delivery-list input[name='delivery']:checked").val()})}else $(".delivery-method").addClass("hidden"),c.tokenType=a,c.deliveryMethod=""}),$(document).translate()}},buttonNameList:["submit","close"],callback:function(a,d){"submit"===a.name?(b(c),d.close()):"close"===a.name&&d.close()}})}function b(a){i=a,$.ajax({type:"post",url:"/iTrader/security/2FARegistration",data:a,success:function(b){b&&b.error?(b&&b.error&&b.error[39]&&(b.error[39]="SSMITSERR_"+b.error[39]),handleError(b.error)):b&&b.data&&(h=b.data,g.showMessage({title:messages.login_2FA_registration_title.text,buttonNameList:"5"==i.tokenType?["relogin","resend"]:["relogin"],closable:!1,closeByBackdrop:!1,closeByKeyboard:!1,message:c(i.tokenType),onshown:function(){"5"==i.tokenType&&d(!1)},callback:function(b){"relogin"===b.name&&(window.location.href="/iTrader/user/logout"),"resend"===b.name&&d(a.sessionID)}}))},error:handleError})}function c(a){if(a){var b=$("<div>",{"class":"col-lg-12 col-md-12 col-xs-12"}),c=$("<p>",{"class":""});if("5"!=a)c.append(messages.login_2FA_registration_message.text.format(maskEmailPhone(h[81])));else{c.append(messages.login_2FA_registration_message_eBrokerKey.text.format(maskEmailPhone(h[81])));var d="<p>"+messages.login_2FA_registration_message_time.text.format(maskEmailPhone(h[131]))+"</p>";c.append(d)}return b.append(c),b}}function d(a){var b=$("#btn-resend"),c=5;null!=c&&void 0!=c&&(console.log(a),a&&e(a),b.attr("disabled","disabled"),b.text(messages.btn_resend.text+"({0}s)".format(c)).removeAttr("ready"),f=setInterval(function(){c--,c<=0?(clearInterval(f),b.removeAttr("disabled"),b.text(messages.btn_resend.text).attr("ready",!0)):b.text(messages.btn_resend.text+"({0}s)".format(c)).removeAttr("ready")},1e3))}function e(a){var b={};b.sessionID=a||"",console.log("========"),$.ajax({type:"post",url:"/iTrader/security/resendActCode",data:b,success:function(a){a&&a.error?(a&&a.error&&a.error[39]&&(a.error[39]="SSMITSERR_"+a.error[39]),handleError(a.error)):a&&a.data&&console.log(a.data)},error:handleError})}var f,g=require("dialog"),h={},i={};exports.register2FA=a,exports.InitResendBtn=d});