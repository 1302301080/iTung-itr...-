function HistoryOrderBook_Initialize(){if(history_orderbook_panel=$("#history-order-book-panel"),!(history_orderbook_panel.length<=0)){history_orderbook_table=$("#history-orderbook-table"),history_orderbook_btn=$("#order-history-btn"),history_status_dropdown=$("#order-history-status-dropdown-group"),history_days_dropdown=$("#order-history-days-dropdown-group");initial_data.views.trade.history_order.schema;history_orderbook_datatable=CreateDatatable(history_orderbook_table,{columnSchema:initial_data.views.trade.history_order.schema,columnHeaderPrefix:"history_order_header_",buttons:[{extend:"print",className:"btn-print"}]});var a=$(history_orderbook_datatable.table().container()),b=history_orderbook_datatable.buttons().container();UpdateDataTableSearchBox(a),b.addClass("pull-right"),b.find("a span").remove(),b.find("a").append($("<i class='fa fa-lg fa-print text-muted'></i>")),b.appendTo(a.find(".dataTables_filter label")),$("#order-history-form").appendTo($(".col-sm-6:eq(0)",history_orderbook_datatable.table().container())),history_orderbook_btn.click(function(){history_orderbook_btn.find(".btn-icon-spinner").removeClass("hidden"),history_orderbook_btn.find(".btn-icon-search").addClass("hidden"),history_orderbook_btn.attr("disabled","disabled"),$.ajax({type:"post",url:"/iTrader/order/history",data:$("#order-history-form").serialize()+"&days="+history_days,success:function(a){HistoryOrderBook_Process(a),HistoryOrderBookBtn_Reset()},error:function(a){handleError(a),HistoryOrderBookBtn_Reset()}})});for(var c={name:{i18n:"history_order_filter_status"},data:[{key:"ALL",value:messages.ALL.text}]},d={name:{i18n:"history_order_filter_days"},data:[]},e=initial_data.views.trade.history_order.filter.status,f=initial_data.views.trade.history_order.filter.days,g=0;g<e.length;g++)c.data.push({key:e[g],value:$._map.status(e[g])});for(var h=0;h<f.length;h++)d.data.push({key:f[h],value:f[h]+messages.history_order_filter_days_before.text});history_status_dropdown.CreateDrowdownGroup(c),history_days_dropdown.CreateDrowdownGroup(d);var i=history_orderbook_datatable.columns().dataSrc();if(i.length>0){var j=i.indexOf("status_text");if(j<=0)return;history_status_dropdown.on("change",function(a,b){b="ALL"===b?"":$._map.status(b),history_orderbook_datatable.column(j).search(b).draw()})}history_days_dropdown.on("change",function(a,b){history_days=b})}}function HistoryOrderBook_Process(a){if(history_orderbook_datatable.clear(),_.isArray(a))for(var b=0;b<a.length;b++){var c=a[b];c.status_text=$._map.status(c[tags.status]),c.side_text=$._map.side(c[tags.side]),c.source_text=$._map.source(c[tags.operatorFlag]),c.datetime=GetDatetimeFromOrder(c)||c[tags.time],c[tags.price]=$._format.price(c[tags.price],SpreadMgr.getSpreadPrecision(c[tags.symbol],c[tags.price])),c[tags.price2]=$._format.price(c[tags.price2],SpreadMgr.getSpreadPrecision(c[tags.symbol],c[tags.price2])+1),c.DT_RowId="orderhistory-"+c[tags.orderNo],history_orderbook_datatable.UpdateRowData(c)}history_orderbook_datatable.draw()}function HistoryOrderBookBtn_Reset(){history_orderbook_btn.find(".btn-icon-spinner").addClass("hidden"),history_orderbook_btn.find(".btn-icon-search").removeClass("hidden"),history_orderbook_btn.removeAttr("disabled")}var history_orderbook_panel,history_orderbook_table,history_orderbook_datatable,history_orderbook_btn,history_days="",history_status_column_index=-1,history_status_dropdown,history_days_dropdown;