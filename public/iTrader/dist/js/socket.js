function SocketIO_Initialize(){var a=window.location.protocol+"//"+window.location.host;g_socket=io.connect(a,{secure:!!_.startsWith(a,"https")}),g_socket.on("auth",function(a){a&&(SubscribeCurrency(),SubscribeExchange(),SubscribeAccounts(),SubscribeSpread(),SubscribePositions(),SubscribeOrders(),SubscribeMessage(),SubscribeMargin(),SubscribeProduct())})}function SubscribeMessage(){g_socket.on("message",function(a){a&&("logout"===a.action?$(".index-row").remove():"announce"===a.action&&PopupAnnouncement(a.announcement),a.errorCode&&handleError(a,function(){"logout"===a.action&&Logout()}))}),g_socket.emit("message")}function SubscribeAccounts(){g_socket.on("account",function(a){if(a&&(a.account_list&&AccountMgr.setAccountList(a),a.balance&&_.isArray(a.balance)))for(var b=0;b<a.balance.length;b++)AccountMgr.set(a.balance[b])}),g_socket.emit("accounts")}function SubscribeOrders(){g_socket.on("orders",function(a){if(a&&_.isArray(a)){var b=[];_(a).forEach(function(c){OrderMgr.set(c,function(c){b.push(c),b.length===a.length&&$(document).trigger("orders",{orders:b})})})}}),g_socket.emit("orders")}function SubscribePositions(){g_socket.on("positions",function(a){if(a&&_.isArray(a)){var b=[];_(a).forEach(function(a){GetProduct(a[tags.symbol],{flag:1});var c=PositionMgr.set(a);c&&b.push(c)}),$(document).trigger("positions",{positions:b})}}),g_socket.emit("positions")}function SubscribeMargin(){g_socket.on("margin",function(a){if(_.isArray(a))for(var b=0;b<a.length;b++){var c=MarginMgr.set(a[b]);$(document).trigger("margin",c)}}),g_socket.emit("margin")}function SubscribeSpread(){g_socket.on("spread",function(a){if(_.isArray(a))for(var b=0;b<a.length;b++)ProductMgr.setSpread(a[b])}),g_socket.emit("spread")}function SubscribeCurrency(){g_socket.on("currency",function(a){if(_.isArray(a))for(var b=0;b<a.length;b++)CurrencyMgr.set(a[b])}),g_socket.emit("currency")}function SubscribeExchange(){g_socket.on("exchange",function(a){if(_.isArray(a))for(var b=0;b<a.length;b++)ExchangeMgr.set(a[b])}),g_socket.emit("exchange")}function SubscribeProduct(){g_socket.on("product",function(a){if(_.isArray(a)){for(var b=[],c=0;c<a.length;c++){var d=ProductMgr.set(a[c]);b.push(d),$(document).trigger("#"+d[tags.symbol],d)}$(document).trigger("products",{products:b})}})}function GetProduct(a,b,c){if(a=_.trim(a)){b=b||{flag:0};var d=_.find(subscribedSymbol,function(b){return b.symbol===a});if(d||(d={symbol:a,count:0},subscribedSymbol.push(d)),"function"==typeof c){var e=ProductMgr.get(a);e?c(e):$(document).one("#"+a,function(b,e){d.state="done",c(e),$(document).off("#"+a,b)})}0==b.flag?"processing"!==d.state&&(d.state="processing",d.count<=0&&g_socket.emit("product",{symbol:a,flag:0})):1==b.flag?(d.count<=0&&g_socket.emit("product",{symbol:a,flag:1}),d.count++):b.flag==-1&&(d.count<=1&&g_socket.emit("product",{symbol:a,flag:-1}),d.count--)}}function refresh(a,b){if(a)if(_.isArray(a))for(var c=0;c<a.length;c++)g_socket.emit("refresh",{type:a[c],data:b});else g_socket.emit("refresh",{type:a,data:b})}var g_socket,subscribedSymbol=[];