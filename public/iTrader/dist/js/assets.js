function Assets_Initialize(){0!=initial_data.views.assets.account.enable?account_summary_datatable=account_summary_table.CreateDatatable({columnSchema:initial_data.views.assets.account.schema,columnHeaderPrefix:"account_summary_header_",searching:!1,scrollCollapse:!0,scrollX:!0,paging:!1,info:!1}):$("#account-summary-item").hide(),position_summary_datatable=position_summary_table.CreateDatatable({columnSchema:initial_data.views.assets.position.schema,columnHeaderPrefix:"position_summary_header_",searching:!1})}function AssetsPositionTable_Draw(a){if(a&&!(a.length<=0)){for(var b=0;b<a.length;b++)AssetsPositionData_Process(a[b]);position_summary_datatable.draw("full-hold"),AssetsMarketValueChart_Draw()}}function AssetsAccountTable_Add(){if(initial_data&&0!=initial_data.views.assets.account.enable){if(AccountMgr.updateAcctInfo(),AccountMgr.account_balance_list){for(var a=0;a<AccountMgr.account_balance_list.length;a++){var b=AccountMgr.account_balance_list[a].data;if(b&&!b[23]){var c=$.extend(!0,{},b);c.DT_RowId="assets-account-"+b[10],util.HandleZeroShowNA(c),account_summary_datatable.UpdateRowData(c)}}account_summary_datatable.draw()}}}function AssetsMarketValue_Calculate(){for(var a=[],b=0;b<position_summary_datatable.data().length;b++){var c=position_summary_datatable.data()[b],d=$._map.exchange(c[tags.exchange]),e=_.find(a,function(a){return a.name===d});e?e.value+=c.globalMarketValue:0!=c.globalMarketValue&&c.globalMarketValue!=Number.NaN&&(e={name:d,value:c.globalMarketValue},a.push(e))}return a}function AssetsMarketValueChart_Draw(){if(!($("#assets-distribution-chart").length<=0)){for(var a=AssetsMarketValue_Calculate(),b=[],c=0,d=0;d<a.length;d++)b.push(a[d].name);var e=$("body").css("color"),f={textStyle:{color:e},animation:!1,title:{text:messages.assets_market_value_chart_title.text+"("+CurrencyMgr.base_currency+")",x:"center",textStyle:{color:e}},tooltip:{trigger:"item",formatter:function(a,b,c){return a.seriesName+" <br />"+a.name+" : "+$._format.amount(a.value)+" ("+a.percent+"%)"}},legend:{orient:"vertical",left:"right",top:30,data:b,textStyle:{color:e}},series:[{name:messages.assets_market_value_chart_title.text,type:"pie",radius:"60%",center:["50%","60%"],data:a,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},g=echarts.init(document.getElementById("assets-distribution-chart"));g.setOption(f);for(var d=0;d<a.length;d++)c+=a[d].value;var h=$("#assets-distribution-chart").parent("div");$(".assets-global-market-value").remove(),h.append($("<div>",{"class":"col-sm-offset-3 col-xs-offset-4 assets-global-market-value"}).append($("<span>",{text:messages.position_summary_header_globalMarketValue.text+"("+CurrencyMgr.base_currency+")"})).append($("<b>",{text:$._format.amount(c),style:"margin-left: 10px"}))),g.on("legendselectchanged",function(b){var c=0;for(var d in b.selected)if(1==b.selected[d])for(var e=0;e<a.length;e++)a[e].name==d&&(c+=a[e].value);h.find(".assets-global-market-value b:last").text($._format.amount(c))})}}function AssetsPositionData_Process(a){if(a){var b=0,c=0,d=0,e=0,f=0,g=0,h=0,i=PositionMgr.get({symbol:a});if(i&&!(i.length<=0)){for(var j=!1,k=!1,l=i[0],m=0;m<i.length;m++){var n=i[m];b+=ToNumber(n[tags.quantity]),c+=ToNumber(n.marketValue),d+=ToNumber(n.globalMarketValue),e+=ToNumber(n.acceptValue),f+=ToNumber(n.unrealizedPL),g+=ToNumber(n.realizedPL),h+=ToNumber(n.costPrice),j||isNaN(n.marketValue)||(j=!0),k||isNaN(n.acceptValue)||(k=!0)}var o=$.extend(!0,{},l);o.DT_RowId="assets-position-"+a,o._id=a,o[tags.quantity]=b,o.marketValue=c,o.globalMarketValue=d,o.acceptValue=e,o.costPrice=h/i.length,o.unrealizedPL=f,o.realizedPL=g,o[31]=getDisplayPrice(l[31],"market",l),o.costPrice=getDisplayPrice(l.costPrice,"avg",l),j||(o.marketValue=Number.NaN,o.globalMarketValue=Number.NaN),k||(o.acceptValue=Number.NaN),util.HandleZeroShowNA(o),position_summary_datatable.UpdateRowData(o,{IsRemove:function(a){return 0==Number(a[tags.quantity])}})}}}var account_summary_table,account_summary_datatable,position_summary_table,position_summary_datatable,accountListUpdateFlag=!1,util;$(function(){$(document).on("page",function(a,b){"shown"===b&&account_summary_datatable&&account_summary_datatable.draw()}),initialize(function(a){seajs.use(["format","socket-v2","datatables","mobile","util"],function(b,c,d,e,f){a||(util=f,account_summary_table=$("#account-summary-table"),position_summary_table=$("#position-summary-table"),Assets_Initialize(),$(document).translate(),seajs.use("account-overall",function(a){a.init($("#account-summary-panel .panel-body"),initial_data.views.assets,AccountMgr)}),seajs.use("cashview",function(a){a.init($("#account-summary-panel .panel-body"),initial_data.views.assets.cashview,AccountMgr,CurrencyMgr)}),c.init(),e.init(),setTimeout(function(){if(CurrencyMgr.base_currency){var a=$("[data-i18n=position_summary_header_globalMarketValue]");a.text().indexOf(CurrencyMgr.base_currency)<0&&a.text(a.text()+" ("+CurrencyMgr.base_currency+")")}position_summary_datatable.draw()},500),PositionMgr.on(function(a){if(a&&!(a.length<=0)){for(var b=[],c=0;c<a.length;c++){var d=a[c][0];b.indexOf(d)<0&&b.push(d)}AssetsPositionTable_Draw(b),accountListUpdateFlag=!0}}),AccountMgr.on(function(){accountListUpdateFlag=!0}))})}),setInterval(function(){accountListUpdateFlag&&(AssetsAccountTable_Add(AccountMgr),accountListUpdateFlag=!1)},1e3)});