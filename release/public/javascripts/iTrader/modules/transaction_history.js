define(function(require,exports,module){function a(){g=initial_data.views.trade.transaction_history,h=$("#transaction-history-form"),i=$("#transaction-history-table"),k=$("#transaction-history-action-dropdown-group"),l=$("#transaction-history-start-date"),m=$("#transaction-history-end-date"),n=$("#transaction-history-btn"),j=i.CreateDatatable({columnSchema:g.schema,order:[0,"desc"],buttons:[{extend:"print",className:"btn-print"}]});var a=$(j.table().container()),b=j.buttons().container();b.addClass("pull-right"),b.find("a span").remove(),b.find("a").append($("<i class='fa fa-lg fa-print text-muted'></i>")),b.appendTo(a.find(".dataTables_filter label")),$("#transaction-history-form").appendTo($(".col-sm-6:eq(0)",a));var c={name:{i18n:"transaction_history_action"},data:[{key:"0",value:messages.ALL.text},{key:"1",value:messages.transaction_history_client_trade.text},{key:"2",value:messages.transaction_history_stock_voucher.text},{key:"3",value:messages.transaction_history_money_voucher.text}]};k.CreateDrowdownGroup(c);var e=g.dateFormat||"yyyy/mm/dd",f=-(g.daysBeforeToday||30);l.val(moment().add(f,"days").format(e.toUpperCase())),m.val(moment().format(e.toUpperCase())),l.datepicker({todayHighlight:!0,autoclose:!0,format:e.toLowerCase()}),m.datepicker({todayHighlight:!0,autoclose:!0,format:e.toLowerCase()}),l.change(function(){o={}}),m.change(function(){o={}}),d(),$(document).translate()}function b(a){if(a&&a.length>0)for(var b=0;b<a.length;b++){var c=a[b],d=c[457];"gettrade"==d?c[11]=messages.oms["trans_side_"+("1"==c[11]?"1":"0")]:"getmoneyvoucher"==d?c[11]=messages.oms["trans_side_"+("1"==c[11]?"2":"3")]:"getstockvoucher"==d&&(c[11]=messages.oms["trans_side_"+("1"==c[11]?"5":"4")])}return a}function c(a){if(j.clear(),a&&a.length>0)for(var b=0;b<a.length;b++)a[b].DT_RowId="transaction-history-"+b,j.UpdateRowData(a[b]);j.draw()}function d(){n.click(function(){l.val()&&m.val()&&(n.find(".btn-icon-spinner").removeClass("hidden"),n.find(".btn-icon-search").addClass("hidden"),n.attr("disabled","disabled"),$.ajax({type:"post",url:"/iTrader/transaction/history",data:e(),success:function(a){a&&(a.data?c(b(a.data)):a.error&&handleError(a.error)),f()},error:function(a){handleError(a),f()}}))})}function e(){var a=k.find("span[data-key]").attr("data-key");return h.serialize()+"&action="+a}function f(){n.find(".btn-icon-spinner").addClass("hidden"),n.find(".btn-icon-search").removeClass("hidden"),n.removeAttr("disabled")}require("datatables");var g,h,i,j,k,l,m,n,o={};exports.init=a});